[gd_scene load_steps=25 format=3 uid="uid://cww17u4c26p4h"]

[ext_resource type="Texture2D" uid="uid://62o77j0kmork" path="res://Assets/Temporales/ovejaM.png" id="1_47pop"]
[ext_resource type="Texture2D" uid="uid://nmx8al30ti8y" path="res://Assets/Temporales/image.jpg" id="1_s1vyc"]
[ext_resource type="PackedScene" uid="uid://wb43sj03rdhh" path="res://Components/interacting_component.tscn" id="2_47pop"]
[ext_resource type="PackedScene" uid="uid://d4neeerux0e3y" path="res://Characters/npc.tscn" id="3_7khpe"]
[ext_resource type="Texture2D" uid="uid://bq788l0mp1uib" path="res://Assets/Finales/background.png" id="4_1ygjx"]
[ext_resource type="PackedScene" uid="uid://tqvckr0nktmj" path="res://Scenes/dialogTestScene/PruebaDialogo.tscn" id="5_1ygjx"]
[ext_resource type="FontFile" uid="uid://cvtyjvr7vc0pi" path="res://Assets/Fonts/lucidagrande-bold.otf" id="7_idgxt"]
[ext_resource type="Script" uid="uid://ddfrxsmxjnr82" path="res://Scenes/Ui.cs" id="7_ukfro"]
[ext_resource type="Texture2D" uid="uid://dkureqhew4ajb" path="res://Assets/Temporales/siluetaOveja.png" id="8_otljr"]
[ext_resource type="Texture2D" uid="uid://clgnafno3ilx2" path="res://Assets/Temporales/moneda.png" id="9_tcxub"]
[ext_resource type="Texture2D" uid="uid://dppse3iy31npq" path="res://Assets/Temporales/pausa.png" id="10_psdm3"]
[ext_resource type="FontFile" uid="uid://buklh0o58ew5g" path="res://Assets/Fonts/lucidagrande.ttf" id="11_2bx17"]
[ext_resource type="PackedScene" uid="uid://cdof2mqmvfv4" path="res://Buildings/fountain.tscn" id="13_sjf4i"]

[sub_resource type="GDScript" id="GDScript_s1vyc"]
script/source = "extends CharacterBody3D

@export var speed: float = 100.0
@export var moral: int = 0
@export var activity: int = 0

func get_input() -> void:
	# 游릭 NUEVO: no procesar input si el movimiento est치 bloqueado
	if not GameState.can_move:
		print(\"jasfjasfja\")
		return

	var input_dir = Vector3.ZERO
	
	# Dir
	if Input.is_action_pressed(\"Up\"):
		input_dir.z -= 1
	if Input.is_action_pressed(\"Down\"):
		input_dir.z += 1
	if Input.is_action_pressed(\"Left\"):
		input_dir.x -= 1
	if Input.is_action_pressed(\"Right\"):
		input_dir.x += 1

	input_dir = input_dir.normalized()

	velocity.x = input_dir.x * speed
	velocity.z = input_dir.z * speed
	

func _physics_process(_delta):
	# 游릭 NUEVO: si el movimiento est치 bloqueado, detener al personaje completamente
	if not GameState.can_move:
		velocity = Vector3.ZERO
		move_and_slide()
		return

	get_input()
	move_and_slide()
	$Camera_Controller.position = lerp($Camera_Controller.position, position, 0.1)
	
	
func change_moral(amount: int) -> void:
	moral += amount
	moral = clamp(moral, -100, 100) # Entre -100 y 100 por ahora
	print(\"Nueva moral:\", moral)

func set_moral(value: int) -> void:

	moral = clamp(value, 0, 100)
	print(\"Moral establecida a:\", moral)

func change_activity(amount: int) -> void:
	activity += amount
	activity = clamp(activity, -100, 100) # Entre -100 y 100 por ahora
	print(\"Actividad:\", activity)

func set_activity(value: int) -> void:

	activity = clamp(value, 0, 100)
	print(\"Actividad establecida a:\", activity)
"

[sub_resource type="BoxShape3D" id="BoxShape3D_s1vyc"]

[sub_resource type="PlaneMesh" id="PlaneMesh_s1vyc"]

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_7khpe"]
shading_mode = 0
albedo_texture = ExtResource("4_1ygjx")

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_tcxub"]
bg_color = Color(0.8862745, 0.83137256, 0.8, 1)
border_width_left = 5
border_width_top = 5
border_width_right = 5
border_width_bottom = 5
border_color = Color(0.23030096, 0.07473131, 0.015937597, 1)
corner_radius_top_left = 20
corner_radius_top_right = 20
corner_radius_bottom_right = 20
corner_radius_bottom_left = 20

[sub_resource type="LabelSettings" id="LabelSettings_otljr"]
font = ExtResource("7_idgxt")
font_size = 40
font_color = Color(0.23137255, 0.07450981, 0.015686275, 1)

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_psdm3"]
bg_color = Color(0.8862745, 0.83137256, 0.8, 1)
border_width_left = 5
border_width_top = 5
border_width_right = 5
border_width_bottom = 5
border_color = Color(0.23137255, 0.07450981, 0.015686275, 1)
corner_radius_top_left = 20
corner_radius_top_right = 20
corner_radius_bottom_right = 20
corner_radius_bottom_left = 20

[sub_resource type="StyleBoxTexture" id="StyleBoxTexture_2bx17"]
texture = ExtResource("10_psdm3")

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_sjf4i"]
bg_color = Color(0.81960785, 0.6431373, 0.53333336, 1)
border_width_left = 10
border_width_top = 10
border_width_right = 10
border_width_bottom = 10
border_color = Color(0.3504598, 0.23772365, 0.16553533, 1)
corner_radius_top_left = 50
corner_radius_top_right = 50
corner_radius_bottom_right = 50
corner_radius_bottom_left = 50

[sub_resource type="LabelSettings" id="LabelSettings_sjf4i"]
font = ExtResource("7_idgxt")
font_size = 56
font_color = Color(0.34901962, 0.23921569, 0.16470589, 1)

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_ukfro"]
bg_color = Color(0.39215687, 0.27450982, 0.19607843, 1)

[node name="TrialScene" type="Node3D"]

[node name="Player" type="CharacterBody3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 0.9999999, 0, 0, 0, 0.9999999, -83, 10, 7)
motion_mode = 1
script = SubResource("GDScript_s1vyc")

[node name="Sheep" type="Sprite3D" parent="Player"]
transform = Transform3D(1, 0, 0, 0, 0.8660254, 0.5, 0, -0.5, 0.8660254, 0, 0, 0)
layers = 2
pixel_size = 0.05
texture = ExtResource("1_47pop")

[node name="CollisionShape3D" type="CollisionShape3D" parent="Player"]
transform = Transform3D(15, 0, 0, 0, 15, 0, 0, 0, 15, 0, 0, 0)
shape = SubResource("BoxShape3D_s1vyc")
debug_color = Color(0.88235295, 0, 0.5137255, 1)

[node name="Camera_Controller" type="Node3D" parent="Player"]
transform = Transform3D(1, 0, 0, 0, 0.9999999, 0, 0, 0, 0.9999999, 0, 10, 7)
top_level = true

[node name="Camera_Target" type="Node3D" parent="Player/Camera_Controller"]
transform = Transform3D(1, 0, 0, 0, 0.70710677, 0.70710677, 0, -0.70710677, 0.70710677, 0, 260, 290)

[node name="Camera3D" type="Camera3D" parent="Player/Camera_Controller/Camera_Target"]
transform = Transform3D(1, 0, 0, 0, 1.0000002, 0, 0, 0, 1.0000002, 0, 0, 0)
doppler_tracking = 2
current = true
fov = 30.0
near = 0.01
far = 1000.0

[node name="InteractingComponent" parent="Player" instance=ExtResource("2_47pop")]
transform = Transform3D(50, 0, 0, 0, 50, 0, 0, 0, 50, 0, 0, 0)

[node name="Background" type="Sprite3D" parent="."]
transform = Transform3D(1, -1.7484555e-07, 7.1054274e-15, 0, -4.3711385e-08, -1, 1.7484554e-07, 1, -4.3711385e-08, 2.1316282e-14, -3, -1.3113416e-07)
visible = false
visibility_range_begin = 30.25
flip_v = true
pixel_size = 0.15
texture = ExtResource("1_s1vyc")

[node name="Camera3D" type="Camera3D" parent="."]
transform = Transform3D(0.19041917, -0.48103794, 0.4233233, 0, 0.7826081, 0.43576026, -0.23182008, -0.39512902, 0.3477217, 214.202, 61.675, 131.31)
visible = false

[node name="MeshInstance3D" type="MeshInstance3D" parent="."]
transform = Transform3D(300, 0, 0, 0, 300, 0, 0, 0, 300, 2.1316282e-14, -3, -1.3113416e-07)
mesh = SubResource("PlaneMesh_s1vyc")
skeleton = NodePath("../Background")
surface_material_override/0 = SubResource("StandardMaterial3D_7khpe")

[node name="NPC1" parent="." instance=ExtResource("3_7khpe")]
transform = Transform3D(5, 0, 0, 0, 5, 0, 0, 0, 5, -95, 10.489868, -82)

[node name="UI" type="CanvasLayer" parent="."]
process_mode = 3
script = ExtResource("7_ukfro")

[node name="nPoblacion" type="Panel" parent="UI"]
offset_left = 74.0
offset_top = 65.0
offset_right = 220.0
offset_bottom = 132.0
scale = Vector2(1.2, 1.2895515)
theme_override_styles/panel = SubResource("StyleBoxFlat_tcxub")

[node name="Label" type="Label" parent="UI/nPoblacion"]
layout_mode = 1
anchors_preset = 6
anchor_left = 1.0
anchor_top = 0.5
anchor_right = 1.0
anchor_bottom = 0.5
offset_left = -86.0
offset_top = -26.5
offset_right = -7.0
offset_bottom = 33.5
grow_horizontal = 0
grow_vertical = 2
theme_override_colors/font_color = Color(0, 0, 0, 1)
theme_override_font_sizes/font_size = 56
text = "55"
label_settings = SubResource("LabelSettings_otljr")
horizontal_alignment = 1
vertical_alignment = 1

[node name="TextureRect" type="TextureRect" parent="UI/nPoblacion"]
modulate = Color(0.23137255, 0.07450981, 0.015686275, 1)
layout_mode = 0
offset_left = 20.833332
offset_top = 13.958342
offset_right = 64.24333
offset_bottom = 51.83834
texture = ExtResource("8_otljr")
expand_mode = 1

[node name="nDinero" type="Panel" parent="UI"]
offset_left = 76.000015
offset_top = 162.0
offset_right = 222.0
offset_bottom = 229.0
scale = Vector2(1.2, 1.2895515)
theme_override_styles/panel = SubResource("StyleBoxFlat_psdm3")

[node name="Label" type="Label" parent="UI/nDinero"]
layout_mode = 1
anchors_preset = 6
anchor_left = 1.0
anchor_top = 0.5
anchor_right = 1.0
anchor_bottom = 0.5
offset_left = -86.0
offset_top = -26.5
offset_right = -7.0
offset_bottom = 33.5
grow_horizontal = 0
grow_vertical = 2
theme_override_colors/font_color = Color(0, 0, 0, 1)
theme_override_font_sizes/font_size = 56
text = "55"
label_settings = SubResource("LabelSettings_otljr")
horizontal_alignment = 1
vertical_alignment = 1

[node name="TextureRect" type="TextureRect" parent="UI/nDinero"]
layout_mode = 0
offset_left = 19.999987
offset_top = 13.1828785
offset_right = 60.374985
offset_bottom = 55.572876
texture = ExtResource("9_tcxub")
expand_mode = 1

[node name="PauseButton" type="Button" parent="UI"]
anchors_preset = 1
anchor_left = 1.0
anchor_right = 1.0
offset_left = -223.99988
offset_top = 53.0
offset_right = -217.07983
offset_bottom = 59.725
grow_horizontal = 0
scale = Vector2(17.468376, 16.209301)
theme_override_styles/normal = SubResource("StyleBoxTexture_2bx17")

[node name="PausePanel" type="Panel" parent="UI"]
custom_minimum_size = Vector2(600, 400)
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
grow_horizontal = 2
grow_vertical = 2
theme_override_styles/panel = SubResource("StyleBoxFlat_sjf4i")

[node name="Pause" type="Label" parent="UI/PausePanel"]
layout_mode = 1
anchors_preset = 5
anchor_left = 0.5
anchor_right = 0.5
offset_left = -186.0
offset_top = 50.0
offset_right = 186.0
offset_bottom = 106.0
grow_horizontal = 2
text = "PAUSE_TITLE"
label_settings = SubResource("LabelSettings_sjf4i")
horizontal_alignment = 1
vertical_alignment = 1

[node name="VBoxContainer" type="VBoxContainer" parent="UI/PausePanel"]
layout_mode = 1
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -250.0
offset_top = -59.0
offset_right = 250.0
offset_bottom = 101.0
grow_horizontal = 2
grow_vertical = 2
theme_override_constants/separation = 40

[node name="MainMenuButton" type="Button" parent="UI/PausePanel/VBoxContainer"]
custom_minimum_size = Vector2(500, 60)
layout_mode = 2
theme_override_fonts/font = ExtResource("11_2bx17")
theme_override_font_sizes/font_size = 30
theme_override_styles/normal = SubResource("StyleBoxFlat_ukfro")
text = "MAIN_MENU_BUTTON"

[node name="ResumeButton" type="Button" parent="UI/PausePanel/VBoxContainer"]
custom_minimum_size = Vector2(500, 60)
layout_mode = 2
theme_override_fonts/font = ExtResource("11_2bx17")
theme_override_font_sizes/font_size = 30
theme_override_styles/normal = SubResource("StyleBoxFlat_ukfro")
text = "RESUME_BUTTON"

[node name="PruebaDialogo" parent="." instance=ExtResource("5_1ygjx")]

[node name="Fountain" parent="." instance=ExtResource("13_sjf4i")]
transform = Transform3D(10, 0, 0, 0, 10, 0, 0, 0, 10, 6, 37, 6)
